<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CryptoCash Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* (এখানে আগের উত্তরের নতুন CSS কোডটিই থাকবে) */
        body{font-family:'Poppins',sans-serif;margin:0;background-color:#f4f7fa;color:#333;line-height:1.6}
        
        /* নতুন লগইন স্ক্রিন */
        #login-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);z-index:100;display:flex;justify-content:center;align-items:center;transition:opacity .5s ease}
        .login-box{background:white;padding:40px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.1);text-align:center;width:90%;max-width:350px}
        .login-box h2{margin-top:0;color:#333;font-weight:600}
        .login-box p{color:#777;margin-bottom:25px}
        .login-box input{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;margin-bottom:15px;box-sizing:border-box;font-family:'Poppins'}
        .login-box button{width:100%;padding:12px;border:none;border-radius:8px;background:#4A00E0;color:white;font-size:1em;font-weight:600;cursor:pointer;transition:background .2s}
        .login-box button:hover{background:#5e29e0}
        #login-error{color:red;font-size:0.9em;margin-top:10px;height:1em}
        
        /* অন্যান্য ডিজাইন */
        header{background:linear-gradient(90deg,#4A00E0,#8A2BE2);color:white;padding:20px;text-align:center;box-shadow:0 4px 6px rgba(0,0,0,0.1)}header h1{margin:0;font-weight:600}.container{max-width:1200px;margin:30px auto;padding:0 20px}.card{background:white;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.07);margin-bottom:30px;overflow:hidden}.card-header{padding:20px;border-bottom:1px solid #eef2f7}.card-header h2{margin:0;font-size:1.25em;color:#4A00E0}.card-content{padding:20px;overflow-x:auto}table{width:100%;border-collapse:collapse;min-width:600px}th,td{padding:15px;text-align:left;border-bottom:1px solid #eef2f7}th{font-weight:600;color:#555;font-size:0.9em;text-transform:uppercase}tr:last-child td{border-bottom:none}tr:hover{background-color:#f9fafb}.btn{padding:8px 16px;border:none;border-radius:6px;cursor:pointer;color:white;font-weight:500;transition:all .2s ease;font-family:'Poppins'}.btn:hover{transform:translateY(-2px);box-shadow:0 2px 4px rgba(0,0,0,0.1)}.btn-approve{background-color:#10b981}.btn-reject{background-color:#ef4444;margin-left:8px}.status{padding:5px 12px;border-radius:99px;font-size:0.85em;font-weight:600;text-align:center}.status-approved{background-color:#d1fae5;color:#065f46}.status-rejected{background-color:#fee2e2;color:#991b1b}.form-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:25px}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:#555}.form-group input{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:1em;box-sizing:border-box;transition:border-color .2s,box-shadow .2s}.form-group input:focus{border-color:#4A00E0;box-shadow:0 0 0 3px rgba(74,0,224,0.1);outline:none}#save-config{background:#4A00E0;margin-top:20px;font-size:1.1em;width:100%;padding:14px}#status-message{text-align:center;font-weight:600;margin-top:15px;transition:opacity .3s}#admin-content{display:none}
    </style>
</head>
<body>
    <div id="login-overlay">
        <div class="login-box">
            <h2>Admin Login</h2>
            <p>Enter your password to access the panel.</p>
            <input type="password" id="admin-password" placeholder="Password">
            <button id="login-button">Login</button>
            <p id="login-error"></p>
        </div>
    </div>
    
    <div id="admin-content">
        <header><h1>CryptoCash Admin Panel</h1></header>
        <div class="container">
            <!-- (বাকি HTML কোড অপরিবর্তিত) -->
            <div class="card">
            <div class="card-header"><h2>App Configuration</h2></div>
            <div class="card-content">
                <div class="form-grid">
                    <div class="form-group"><label for="bot-name">Bot Name</label><input type="text" id="bot-name"></div>
                    <div class="form-group"><label for="bot-username">Bot Username</label><input type="text" id="bot-username"></div>
                    <div class="form-group"><label for="reward-ad">Reward per Ad</label><input type="number" id="reward-ad"></div>
                    <div class="form-group"><label for="ad-limit">Daily Ad Limit</label><input type="number" id="ad-limit"></div>
                    <div class="form-group"><label for="min-withdraw">Min Withdrawal Coins</label><input type="number" id="min-withdraw"></div>
                    <div class="form-group"><label for="reward-referral">Reward per Referral</label><input type="number" id="reward-referral"></div>
                    <div class="form-group"><label for="max-referrals">Max Referrals Limit</label><input type="number" id="max-referrals"></div>
                </div>
                <button class="btn" id="save-config">Save Settings</button>
                <p id="status-message"></p>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><h2>Pending Withdrawals</h2></div>
            <div class="card-content">
                <table id="pending-table">
                    <thead><tr><th>User ID</th><th>Username</th><th>Amount</th><th>Address</th><th>Date</th><th>Actions</th></tr></thead>
                    <tbody><tr><td colspan="6">Loading...</td></tr></tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header"><h2>Processed Withdrawals</h2></div>
            <div class="card-content">
                <table id="processed-table">
                    <thead><tr><th>User ID</th><th>Username</th><th>Amount</th><th>Address</th><th>Date</th><th>Status</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        </div>
    </div>

    <script>
        // আপনার দেওয়া নতুন পাসওয়ার্ড এখানে সেট করা হয়েছে
        const ADMIN_PASSWORD = "40707@#$";

        function authenticate() {
            const loginButton = document.getElementById('login-button');
            const passwordInput = document.getElementById('admin-password');
            const loginError = document.getElementById('login-error');

            loginButton.addEventListener('click', () => {
                if (passwordInput.value === ADMIN_PASSWORD) {
                    const overlay = document.getElementById('login-overlay');
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 500);
                    document.getElementById('admin-content').style.display = 'block';
                    initializeApp();
                } else {
                    loginError.textContent = 'Incorrect password!';
                    passwordInput.value = '';
                }
            });
            // Allow pressing Enter to log in
            passwordInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    loginButton.click();
                }
            });
        }

        function initializeApp() {
            // (বাকি জাভাস্ক্রিপ্ট কোডটি আগের মতোই)
            const firebaseConfig={apiKey:"AIzaSyBNBAupa-P-NA5WuttGiGFiL0TPUmcU0NM",authDomain:"chats-ab4af.firebaseapp.com",databaseURL:"https://chats-ab4af-default-rtdb.firebaseio.com",projectId:"chats-ab4af",storageBucket:"chats-ab4af.appspot.com",messagingSenderId:"317093436715",appId:"1:317093436715:web:5cf4391b87f51eade4b96e"};firebase.initializeApp(firebaseConfig);const db=firebase.database(),configRef=db.ref("config");configRef.on("value",e=>{const t=e.val();t&&(document.getElementById("bot-name").value=t.BOT_NAME,document.getElementById("bot-username").value=t.BOT_USERNAME,document.getElementById("reward-ad").value=t.REWARD_PER_AD,document.getElementById("ad-limit").value=t.BASE_AD_LIMIT,document.getElementById("min-withdraw").value=t.MINIMUM_WITHDRAWAL_COINS,document.getElementById("reward-referral").value=t.REWARD_PER_REFERRAL,document.getElementById("max-referrals").value=t.MAX_REFERRALS)}),document.getElementById("save-config").addEventListener("click",()=>{const e={BOT_NAME:document.getElementById("bot-name").value,BOT_USERNAME:document.getElementById("bot-username").value,REWARD_PER_AD:Number(document.getElementById("reward-ad").value),BASE_AD_LIMIT:Number(document.getElementById("ad-limit").value),MINIMUM_WITHDRAWAL_COINS:Number(document.getElementById("min-withdraw").value),REWARD_PER_REFERRAL:Number(document.getElementById("reward-referral").value),MAX_REFERRALS:Number(document.getElementById("max-referrals").value)};configRef.update(e).then(()=>{const e=document.getElementById("status-message");e.textContent="Settings saved successfully!",e.style.color="green",setTimeout(()=>e.textContent="",3e3)})});const withdrawalsRef=db.ref("withdrawals");withdrawalsRef.on("value",e=>{const t=e.val(),a=document.querySelector("#pending-table tbody"),d=document.querySelector("#processed-table tbody");if(a.innerHTML="",d.innerHTML="",!t)return void(a.innerHTML='<tr><td colspan="6" style="text-align:center;">No pending withdrawals.</td></tr>');const n=Object.values(t).sort((e,t)=>t.timestamp-e.timestamp);let o=!1;for(const i of n){const l=(new Date(i.timestamp)).toLocaleString();"Pending"===i.status?(o=!0,a.innerHTML+=`<tr>\n                            <td>${i.userId}</td><td>@${i.username}</td><td>${i.amount}</td>\n                            <td>${i.address}</td><td>${l}</td>\n                            <td>\n                                <button class="btn btn-approve" onclick="approveWithdrawal('${i.id}', '${i.userId}')">Approve</button>\n                                <button class="btn btn-reject" onclick="rejectWithdrawal('${i.id}', '${i.userId}', ${i.amount})">Reject</button>\n                            </td></tr>`):d.innerHTML+=`<tr>\n                            <td>${i.userId}</td><td>@${i.username}</td><td>${i.amount}</td>\n                            <td>${i.address}</td><td>${l}</td>\n                            <td><span class="status status-${i.status.toLowerCase()}">${i.status}</span></td></tr>`}o||(a.innerHTML='<tr><td colspan="6" style="text-align:center;">No pending withdrawals.</td></tr>')})
        }
        
        async function approveWithdrawal(withdrawalId, userId) {
            const updates = {};
            updates[`/withdrawals/${withdrawalId}/status`] = 'Approved';
            updates[`/users/${userId}/withdrawalHistory/${withdrawalId}/status`] = 'Approved';
            await firebase.database().ref().update(updates);
            alert('Withdrawal Approved!');
        }

        async function rejectWithdrawal(withdrawalId, userId, amount) {
            const reason = prompt("Please enter the reason for rejection:");
            if (reason === null) return; // Admin cancelled the prompt

            // Refund coins to user
            const userCoinsRef = firebase.database().ref(`/users/${userId}/coins`);
            await userCoinsRef.transaction((currentCoins) => (currentCoins || 0) + amount);

            // Update status and add rejection reason
            const updates = {};
            updates[`/withdrawals/${withdrawalId}/status`] = 'Rejected';
            updates[`/withdrawals/${withdrawalId}/rejectionReason`] = reason;
            updates[`/users/${userId}/withdrawalHistory/${withdrawalId}/status`] = 'Rejected';
            updates[`/users/${userId}/withdrawalHistory/${withdrawalId}/rejectionReason`] = reason;
            
            await firebase.database().ref().update(updates);
            alert('Withdrawal Rejected and coins refunded!');
        }
        
        // Authenticate on page load
        authenticate();
    </script>
</body>
</html>